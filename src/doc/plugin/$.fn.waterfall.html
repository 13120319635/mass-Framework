<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>$.fn.waterfall</title>
        <script src="../public/js/mass_merge.js" type="text/javascript" ></script>
        <script src="../public/js/common.js" type="text/javascript" ></script>
        <script src="../public/js/shCore.js" type="text/javascript" ></script>
        <script src="../public/js/shBrushJScript.js" type="text/javascript" ></script>
        <script src="../public/js/shBrushCss.js" type="text/javascript" ></script>
        <script src="../public/js/shBrushXml.js" type="text/javascript" ></script>
        <link type="text/css" rel="stylesheet" href="../public/styles/shCore.css"/>
        <link type="text/css" rel="stylesheet" href="../public/styles/shThemeRDark.css"/>
        <link type="text/css" rel="stylesheet" href="../public/styles/common.css"/>
        <link type="text/css" rel="stylesheet" href="../public/styles/plugin/pager.css"/>
        <style type="text/css">

            #waterfall{
                background: url("../public/styles/waterfall/waterfall_bc.jpg") repeat scroll 0 0 transparent;
            }
            .clearfix:after {
                content: "";
                display: block;
                height: 0;
                clear: both;
                visibility: hidden;
            }
            .clearfix {zoom:1;}
            .tile{
                width:198px;
                padding:20px;
                margin-top:10px;
                border:1px solid #000;
                -moz-box-shadow:2px 2px 10px #c96;
                -webkit-box-shadow:2px 2px 10px #c96;
                box-shadow:2px 2px 10px #c96;
                background:#fff;
            }
            .tile .dis{
                width:198px;
                color:#000;
            }
            .footer{
                height:24px;
                line-height:24px;
                background:gray;
            }
        </style>
        <script type="text/javascript">
            SyntaxHighlighter.config.clipboardSwf = '../js/clipboard.swf';
            SyntaxHighlighter.all();
            $.require("ready,more/waterfall",function(){

                var data = [{
                        img_src:"0.jpg",
                        title:"梦回紫禁城"
                    },
                    {
                        img_src:"1.jpg",
                        title:"【信息图】2012中国网络视频 - 爱库网 Beta"
                    },
                    {
                        img_src:"2.jpg",
                        title:"图像"
                    },
                    {
                        img_src:"3.jpg",
                        title:"完美嫁衣"
                    },
                    {
                        img_src:"4.jpg",
                        title:"简单百搭的深灰色马甲，料子很舒服！"
                    },
                    {
                        img_src:"5.jpg",
                        title:"解剖完美网页"
                    },
                    {
                        img_src:"6.jpg",
                        title:"七月的婚纱"
                    },
                    {
                        img_src:"7.jpg",
                        title:"淘宝数据盛宴 - 热门盛宴"
                    },
                    {
                        img_src:"8.jpg",
                        title:"日本插画师yuko kitazawa作品《童年》"
                    },
                    {
                        img_src:"9.jpg",
                        title:"美食工坊：【DIY炒面~】只需简单准备材料，各种调味品即可！很简单的哦"
                    },

                    {
                        img_src:"10.jpg",
                        title:"淘宝数据"
                    },
                    {
                        img_src:"11.jpg",
                        title:"川上六角"
                    },
                    {
                        img_src:"12.jpg",
                        title:"美食、甜点、蛋糕、咖啡"
                    },
                    {
                        img_src:"13.jpg",
                        title:"鲜花"
                    },
                    {
                        img_src:"14.jpg",
                        title:"ISO5"
                    },
                    {
                        img_src:"15.jpg",
                        title:"dribbble上看到的一个超强啤酒写实设计，很想知道泡沫是怎么做的"
                    },
                    {
                        img_src:"16.jpg",
                        title:"通向天堂的彩虹，一路顺风~~"
                    },
                    {
                        img_src:"17.jpg",
                        title:"我们都曾有这么天真无邪的青葱岁月,好怀念啊!~~"
                    },
                    {
                        img_src:"18.jpg",
                        title:"地产 楼书 商业 招商手册 房地产 投资"
                    },
                    {
                        img_src:"19.jpg",
                        title:"【厦门招聘：亲们，招聘图很有靓点哦】创意对于生意来说就像氧气对于人体一样重要；ideainside寻找网络营销策划、资深设计师、有经验的项目执行人员！大家也可以关注《厦门商报》对本创意招聘广告的报道！招聘人：@曹芳华 另推荐网络营销专家一枚@焚天"
                    },
                    {
                        img_src:"20.jpg",
                        title:"国外精美年报画册设计欣赏-设计欣赏-素材中国"
                    },
                    {
                        img_src:"21.jpg",
                        title:"美食.秀色可餐"
                    },
                    {
                        img_src:"22.jpg",
                        title:"查看《功夫熊猫同人——沈王爷》原图"
                    },
                    {
                        img_src:"23.jpg",
                        title:"伞"
                    },
                    {
                        img_src:"24.jpg",
                        title:"长颈鹿和蜜蜂"
                    },
                    {
                        img_src:"25.jpg",
                        title:"我也不想的"
                    },
                    {
                        img_src:"26.jpg",
                        title:"你送我的蝴蝶结，我一直有带着"
                    },
                    {
                        img_src:"27.jpg",
                        title:"这种开放式衣柜，是多少MM的最爱啊"
                    },
                    {
                        img_src:"28.jpg",
                        title:"如果真的爱了，不要轻言放弃，即便他让你伤心了，试着去牵挂他，倾听他，让他明白你依然关爱他；如果真的爱了，不要轻言放弃，即便他让你失望了，试着去包容他，让他知道你依然在乎他。爱情是个很奇妙的东西，具有无穷的魔力，让人为之着迷。爱一个人，就会爱他的所有.."
                    },
                    {
                        img_src:"29.jpg",
                        title:"这个好棒"
                    },
                    {
                        img_src:"30.jpg",
                        title:"我的风景不说谎"
                    },
                    {
                        img_src:"31.jpg",
                        title:"乐观主义者就是，拿再少的薪资也很高兴。悲观主义者就是，拿再多的薪资也不开心。现实主义者就是，等拿到薪资再决定自己是乐观主义还是悲观主义"
                    },
                    {
                        img_src:"32.jpg",
                        title:"爱因斯坦喵"
                    },
                    {
                        img_src:"33.jpg",
                        title:"萌 主。 -- TOPIT.ME 收录优美图片"
                    },
                    {
                        img_src:"34.jpg",
                        title:"见证历史的韵味老屋~ 来自Alyssa林小媛在堆糖网的分享"
                    },
                    {
                        img_src:"35.jpg",
                        title:"我们都爱古诗词：多少黄昏烟雨斜檐，翻开诗篇，勾起了一纸江南。>>>推荐关注@美文中国风"
                    },
                    {
                        img_src:"36.jpg",
                        title:"情人节快乐！"
                    },
                    {
                        img_src:"37.jpg",
                        title:"【全球互联网行业数据解读】1. 全球网民超20亿，中国占20%以上；2. 互联网服务三原色：媒体、娱乐、商务；3. 网络广告和网购占整体规模偏低；4. 网游市场增长率降低，利润高达90%；5. 广告主从传统媒体转向网络，美国网络广告是中国的3倍；6. 趋势：SoLoMo+云。"
                    },
                    {
                        img_src:"38.jpg",
                        title:"Nine d’Urso 街拍：巴黎女人的时尚经——小黑裙<br/>\
材质和剪裁是最重要的，简约为美；配饰不在多，但要恰到好处，比如太阳镜<br/>\
日装小黑裙忌过度装饰"
                    },
                    {
                        img_src:"39.jpg",
                        title:"爱花之人一定要了解！我们一起赏花去~"
                    },
                    {
                        img_src:"40.jpg",
                        title:"这是个无情的世界，因为有希望的地方就必定有磨炼。——《1Q84》"
                    },
                    {
                        img_src:"41.jpg",
                        title:"总有一些美妙风景，让你止不住举起镜头。"
                    },
                    {
                        img_src:"42.jpg",
                        title:"复古铜簪子汉服 发簪步摇古典玉石花朵发簪"
                    },
                    {
                        img_src:"43.jpg",
                        title:"颜色，还是木头"
                    },
                    {
                        img_src:"44.jpg",
                        title:"瑞典北欧风情的大户型公寓设计"
                    },

                    {
                        img_src:"45.jpg",
                        title:"意大利的魅力小镇。"
                    },
                    {
                        img_src:"46.jpg",
                        title:"一组来自Legas Delaney 的公益广告。雕刻的叶子告诉人们那一片片绿色可以解决那么多污染问题，所以多植树吧！"
                    },
                    {
                        img_src:"47.jpg",
                        title:"'pantone 1797 c'-----法國食品設計師EMILIE為特色法國美食雜誌fricote開發的甜點挞，看上去好美味啊！"
                    },

                    {
                        img_src:"48.jpg",
                        title:"沙漠中的花，也能开出绚烂的颜色 ~你也喜欢这样的美吗？"
                    },

                    {
                        img_src:"49.jpg",
                        title:"那一低头的娇羞~"
                    },

                    {
                        img_src:"50.jpg",
                        title:"恍如仙境，不愿做神仙，愿作山中人。"
                    },

                    {
                        img_src:"51.jpg",
                        title:"赏心悦目的小绿植，喜欢的转~"
                    },

                    {
                        img_src:"52.jpg",
                        title:"电影工厂：绝妙！！"
                    },

                    {
                        img_src:"53.jpg",
                        title:"站成永恒，没有悲欢的姿势。一半在尘土里安详，一半在风里飞扬，一半洒落阴凉，一半沐浴阳光。当音乐的水漫上来，时光与瞳孔都遗失了方向，悄悄地在风里冷眼旁观，誰的流年，悄悄沧桑了誰的朝华"
                    },

                    {
                        img_src:"54.jpg",
                        title:"暮光之城"
                    },
                    {
                        img_src:"55.jpg",
                        title:"宠物中心：天寒地冻，不想起床！！ "
                    },
                    {
                        img_src:"56.jpg",
                        title:"云冈石窟：云冈石窟于敦煌莫高窟、洛阳龙门石窟齐名，并称“中国三大石窟”。石窟位于大同城西16公里处的武周山麓，始创于北魏，距今已有1500多年。现存洞窟53个，东西绵延约一公里，内有造像51000余尊。"
                    },
                    {
                        img_src:"57.jpg",
                        title:"在心头洒下梦的种子，让清晨因无限可能而迷人。"
                    },
                    {
                        img_src:"58.jpg",
                        title:"趁阳光正好。趁微风不噪。趁繁花还未开至荼蘼。趁现在还年轻，还可以走很长很长的路，还能诉说很深很深的思念。"
                    },
                    {
                        img_src:"59.jpg",
                        title:"【阳光的句子】常常提醒自己注意幸福，就像在寒冷的日子里经常看看太阳，心就不知不觉暖洋洋亮光光。"
                    },
                    {
                        img_src:"60.jpg",
                        title:"美！就一个字！"
                    },
                    {
                        img_src:"61.jpg",
                        title:"离开你就是旅行的意义。。。"
                    },
                    {
                        img_src:"62.jpg",
                        title:"迷上中国风：美轮美奂的中国画卷。"
                    },
                    {
                        img_src:"63.jpg",
                        title:"在哪里都能睡的树袋熊"
                    },
                    {
                        img_src:"64.jpg",
                        title:"栗子焖鸡块"
                    },
                    {
                        img_src:"65.jpg",
                        title:"褐色的山石翠绿的树，薄薄的雾气萦绕山间。"
                    },
                    {
                        img_src:"66.jpg",
                        title:"棉花糖"
                    },
                    {
                        img_src:"67.jpg",
                        title:"风信子"
                    },
                    {
                        img_src:"68.jpg",
                        title:"f tea吗？来海南吧，感受浮潜的魅力！"
                    },
                    {
                        img_src:"69.jpg",
                        title:"波兰设计师layaweek 网页设计作品"
                    },
                    {
                        img_src:"70.jpg",
                        title:"胡萝卜 "
                    },
                    {
                        img_src:"71.jpg",
                        title:"口香糖自制小花盆"
                    },
                    {
                        img_src:"72.jpg",
                        title:"玫瑰"
                    },
                    {
                        img_src:"73.jpg",
                        title:"红鲻鱼"
                    },
                    {
                        img_src:"74.jpg",
                        title:"一碗清粥"
                    },
                    {
                        img_src:"75.jpg",
                        title:"郁金香"
                    },
                    {
                        img_src:"76.jpg",
                        title:"红狐狸 "
                    },
                    {
                        img_src:"77.jpg",
                        title:"苏州古城区古典生活 "
                    },
                    {
                        img_src:"78.jpg",
                        title:"来自东土日本，喜欢顶东西、喜欢卖萌。日本名称“老子猫”，来中国后得名“猫叔”。另，日本的环境还是很不错滴，有那么多滴花........"
                    },
                    {
                        img_src:"79.jpg",
                        title:"教名山加上金顶的称谓，让人产生无限遐想。"
                    },
                    {
                        img_src:"80.jpg",
                        title:"西藏-羊卓雍湖"
                    },
                    {
                        img_src:"81.jpg",
                        title:"广州人们最淳朴的生活，别有一番味道……"
                    },
                    {
                        img_src:"82.jpg",
                        title:"味，让人看了都留恋，不知道你的感觉如何？"
                    },
                    {
                        img_src:"83.jpg",
                        title:"好想买一套哟~"
                    },
                    {
                        img_src:"84.jpg",
                        title:"凤凰古城，值得一去哦。。。"
                    },
                    {
                        img_src:"85.jpg",
                        title:"澳大利亚堪培拉布鲁斯区（Bruce）的Jamie Scarrow拍摄的《幽蓝冰窟》。2011年12月摄于南极洲。"
                    },
                    {
                        img_src:"86.jpg",
                        title:"华盖"
                    },
                    {
                        img_src:"87.jpg",
                        title:"嘀咕 — 发现精彩"
                    },
                    {
                        img_src:"88.jpg",
                        title:"所谓幸福，是有一颗感恩的心，一个健康的身体，一份称心的工作，一位深爱你的爱人，一帮值得信赖的朋友。"
                    },
                    {
                        img_src:"89.jpg",
                        title:"展翅高飞"
                    },
                    {
                        img_src:"90.jpg",
                        title:"蘑菇"
                    },
                    {
                        img_src:"91.jpg",
                        title:"树间灵光"
                    },
                    {
                        img_src:"92.jpg",
                        title:"我们有时会错误地以为，得不到的，才是珍贵的，已经拥有的，都是廉价的。得不到的，因为缺少深入的了解，它只是一种美好的假象，展示给我们一个绚丽的外表。如果有那么一天，你距离它近了，知道了它的真相，你才发现，它和我们拥有的，竟是那么的相似。别把眼光停留在想象中，你拥有的，都是你的幸福。"
                    },
                    {
                        img_src:"93.jpg",
                        title:"节气"
                    },
                    {
                        img_src:"94.jpg",
                        title:"智利插画师Oscar Ramos的一幅作品"
                    },
                    {
                        img_src:"95.jpg",
                        title:"德国布伦瑞克的Rizzi楼（Rizzi House）_我不是文艺男的收藏_我喜欢"
                    },
                    {
                        img_src:"96.jpg",
                        title:"德国布伦瑞克的Rizzi楼（Rizzi House）_我不是文艺男的收藏_我喜欢"
                    },
                    {
                        img_src:"97.jpg",
                        title:"猫咪们"
                    },
                    {
                        img_src:"98.jpg",
                        title:"2010.4 瑞士提切诺州马焦雷湖\
每一年里大概都有一天左右，这栋布鲁尔的房子外被圈束的花岗岩石墙会被红色的山茶花瓣覆盖。"
                    },
                    {
                        img_src:"99.jpg",
                        title:"白孔雀开屏"
                    }
                ].map(function(el){
                    el.img_src = "../public/styles/waterfall/"+ el.img_src;
                    return el;
                });
                var waterfall = $("#waterfall").waterfall({
                    ejs_id:"tile_tmpl",
                    col: 4,
                    width:1100,
                    img_expr:".big_img",
                    col_width:246,
                    fade: true,
                    callback: function(){
                        if(!this._first){//最开始的砖头不需要透明
                            var tiles = this.tiles.slice(0,5);
                            for(var i = 0, el; el = tiles[i++];){
                                el.css("o",1)
                            }
                            this._first = true;
                        }
                    }
                }).waterfall("getUI");

                waterfall.addTiles( data.splice(0,10) )
                waterfall.scroll(function(rollHeight, pageHeight){
                    if(typeof rollHeight == "number"){
                        if(rollHeight + 30 > $(".footer").offset().top){
                            waterfall.addTiles( data.splice(0,10) )
                        }
                    }
                });
                var now = 0, ui = waterfall, interval = ui.interval, tiles = ui.tiles;
                $(window.parent).scroll(function(){
                    var time = new Date;
                    if(time - now > interval ){
                        now = time;
                        var pageHeight = $(parent.document).height(), rollHeight = $(window.parent).scrollTop() +  $(window.parent).height()
                        for( var i = 0; i < tiles.length; i++ ){
                            var tile = tiles[i], top = tile.offset().top;//取得元素相对于整个页面的Y位置
                            if( rollHeight >= top ) { //如果页面的滚动条拖动要处理的元素所在的位置
                                if(ui.fade){
                                    tile.fx( ui.fade_time,{
                                        o:1
                                    });
                                }
                            }
                        }
                        if(rollHeight  > $("#iframe",parent.document).height()){
                            ui.addTiles( data.splice(0,10) )
                        }
                    }
                })
            });

            // http://www.xarg.org/2011/09/jquery-pagination-revised/
        </script>
    </head>
    <body>
    <article>
        <h3>$.fn.waterfall</h3>
        <p><span class="stress">描述：</span></p>
        <p>mass Framework的瀑布流控件。</p>
        <p>瀑布流通常分为三部分，容器，栏栅，砖块。砖头里面基本上都塞着一张大图，本来瀑布流就是以图片来吸引眼球的。网上绝对大多数瀑布流都是通过绝对定位来设置砖头的位置，但这也非常依赖于后端的支持，除去图片的裁剪不说，一定要把图片的大小预先给出来，然后前端要通过复杂的计算求得它在瀑布的top与left。万一有一天PM要实现即时删除某一砖头的功能，那么这重排的计算量就大了。因此我的瀑布流有如下优点，浮动布局，对后端依赖极小。</p>
        <p>本控件依赖于我的ejs模板，藉此将后端传过来的JSON数据变成HTML数据，然后通过addTiles方法，将HTML数据变成元素节点。</p>
        <p>由于是使用浮动布局，因此必须在容器上添加clearfix这个著名的清除浮动类。具体定义如下：</p>
        <pre class="brush:css;gutter:false;toolbar:false">
           .clearfix:after {
                content: "";
                display: block;
                height: 0;
                clear: both;
                visibility: hidden;
            }
            .clearfix {zoom:1;}
        </pre>
        <p><span class="stress">参数：</span></p>
        <dl>
            <dt>settings</dt>
            <dd>可选。用于配置控件对象。但当这个对象第二次调用它时，
                只有当其第一个参数为字符串或对象才有效，这样相当于调用其方法或重写一些属性。</dd>
        </dl>
        <p><span class="stress">返回值：</span></p>
        <p>mass实例</p>
        <p><span class="stress">settings的配置参数：</span></p>
        <ul>
            <li>img_expr:<span style="color:red">必需</span>，砖块里面的大图的CSS表达式，用于在其加载完毕后添加下一个砖头。</li>
            <li>col:<span style="color:red">必需</span>，瀑布流里一共多少列(栏栅)。</li>
            <li>col_width:<span style="color:red">必需</span>，栏栅的宽，注意其值必须比砖块大。</li>
            <li>ejs_id:<span style="color:red">必需</span>，砖块的模板的ID值。</li>
            <li>callback:当所有砖头添加完毕后触发的回调，this指向UI实例。</li>
            <li>width:容器的宽，如果没有指定，会直接取ui.target.width()作为它的值。</li>
            <li>interval:瀑布流会在window上绑定一个scroll事件, 这是滚轮每隔多少毫秒触发一次回调。默认是20</li>
            <li>fade:是否使用淡入效果,如果是它会在添加时就把其透明值设为零,然后在scroll事件时,当滚动条拖到此砖块的位置时就开始淡入动画。默认为false.</li>
            <li>fade_time:淡入动画的持续时间。默认是500。</li>
        </ul>
        <p>生成的UI实例拥有以下方法，都是使用$(expr).waterfall(method,args1,args2,args3)的形式进行调用，或者通waterfall("getUI")取得实例后再调用它们。</p>
        <ul>
            <li>addTiles(json): 添加一组砖块，json这是一个对象数组。</li>
            <li>addTile(html, htmls ,index )，添加砖块。html为htmls中的第一个元素，html是上面json数组用ejs模板经过转换后成为一个字符串数组。index表示添加到第几列中去。</li>
            <li>getShortestColumn(): 此方法通常是被addTile内部调用，求得最短的栏栅的索引值，以方便添加的新的砖块。</li>
            <li>scroll(callback): 绑定scroll事件到window，如果fade为true，请务必执行此方法，即使不传参也行。
                callback在滚动时会多次触发，传参的参数并不一样。一种情况是某一个砖块出现到滚动条的拖动块的位置时，这时传参是el（砖块，一个mass实例）。
                另一种情况是用于判定滚动条是否接近页面底部（放便使用AJAX加载下一批数据），传参数据为rollHeight（滚过的距离）, pageHeight（页面高）
            </li>
            <li>destory(): 销毁实例，移除动态添加的节点。</li>
        </ul>
        <p>生成的UI实例拥有以下属性。</p>
        <ul>
            <li>parent: 即$(expr)。</li>
            <li>target:同上。</li>
            <li>cols: 动态生成的列的集合，一个对象数组，里面都是栏栅的mass实例。</li>
            <li>tiles: 动态生成的砖块的集合，一个对象数组，里面都是砖块的mass实例（内容参考ejs模板）</li>
        </ul>

        <fieldset><legend>例子</legend>
            <pre class="brush:css;gutter:false;toolbar:true;collapse:true;">
            #waterfall{
                 background: url("../public/styles/waterfall/waterfall_bc.jpg") repeat scroll 0 0 transparent;
            }
            .clearfix:after {
                content: "";
                display: block;
                height: 0;
                clear: both;
                visibility: hidden;
            }
            .clearfix {zoom:1;}
            .tile{
                width:198px;
                padding:20px;
                margin-top:10px;
                border:1px solid #000;
                -moz-box-shadow:2px 2px 10px #c96;
                -webkit-box-shadow:2px 2px 10px #c96;
                box-shadow:2px 2px 10px #c96;
                background:#fff;
            }
            .tile .dis{
                width:198px;
            }
            .footer{
                height:24px;
                line-height:24px;
                background:gray;
            }
            </pre>
            <pre class="brush:html;gutter:false;toolbar:true;collapse:true;">
        &lt;script type="text/tmpl" id="tile_tmpl"&gt;
                &lt;div class="tile"&gt;
                     &lt;img src="&lt;&= @img_src &&gt;" class="big_img" /&gt;
                     &lt;div class="dis" &gt;&lt;&= @title &&gt;&lt;/div&gt;
                &lt;/div&gt;
        &lt;/script&gt;
        &lt;div id="waterfall" class="clearfix"&gt;&lt;/div&gt;
        &lt;div class="footer"&gt;这是页脚&lt;/div&gt;
            </pre>
            <pre class="brush:js;gutter:false;toolbar:true;collapse:true;">
         $.require("ready,more/waterfall",function(){
                var waterfall = $("#waterfall").waterfall({
                    ejs_id:"tile_tmpl",
                    col: 4,
                    width: 1100,
                    img_expr:".big_img",
                    col_width:246,
                    fade: true,
                    callback: function(){
                        if(!this._first){//最开始的砖头不需要透明
                            var tiles = this.tiles.splice(0,5);
                            for(var i = 0, el; el = tiles[i++];){
                                el.css("o",1)
                            }
                            this._first = true;
                        }
                    }
                }).waterfall("getUI");

                waterfall.addTiles( data.splice(0,10) )
                waterfall.scroll(function(rollHeight, pageHeight){
                    if(typeof rollHeight == "number"){
                        console.log(rollHeight +"  "+ pageHeight)
                        if(rollHeight + 30 > $(".footer").offset().top){
                           waterfall.addTiles( data.splice(0,10) );
                         }
                    }
                })
            })
            </pre>
            <br/>
            <script type="text/tmpl" id="tile_tmpl">
                    <div class="tile">
                    <img src="<&= @img_src &>" class="big_img" />
                    <div class="dis" ><&= @title &></div>
                    </div>
            </script>
            <div id="waterfall" class="clearfix"></div>
            <div class="footer">这是页脚</div>
        </fieldset>
    </article>
</body>
</html>