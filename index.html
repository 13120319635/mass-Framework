<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="UTF-8">
        <title>scope</title>
        <style>
            .my-class{
                color: yellow;
                background:orange;
            }
            .your-class {
                line-height:3;
                width:200px;
                height:100px;
            }
            .his-class{
                text-indent:2em;
                font-size:14px;
            }

            .blink{
                width:200px;
                height:100px;
                background:yellow
            }
        </style>
        <link rel="stylesheet" href="http://files.cnblogs.com/rubylouvre/todos.css"/>
        <style>
            body { font-family: arial; font-size: 14px; }
            .liveExample { padding: 1em; background-color: #EEEEDD; border: 1px solid #CCC; max-width: 655px; }
            .liveExample input { font-family: Arial; }
            .liveExample b { font-weight: bold; }
            .liveExample p { margin-top: 0.9em; margin-bottom: 0.9em; }
            .liveExample select[multiple] { width: 100%; height: 8em; }
            .liveExample h2 { margin-top: 0.4em; }

            .ms-grid { margin-bottom: 1em; width: 25em; border: 1px solid silver; background-color:White; }
            .ms-grid th { text-align:left; background-color: Black; color:White; }
            .ms-grid td, th { padding: 0.4em; }
            .ms-grid tr:nth-child(odd) { background-color: #DDD; }
            .ms-grid-pageLinks { margin-bottom: 1em; }
            .ms-grid-pageLinks a { padding: 0.5em; }
            .ms-grid-pageLinks a.selected { background-color: Black; color: White; }
            .liveExample { height:20em; overflow:auto } /* Mobile Safari reflows pages slowly, so fix the height to avoid the need for reflows */

            li { list-style-type: disc; margin-left: 20px; }

        </style>
    </head>
    <body>


        <script src="avalon.js" type="text/javascript"></script>


        <script type="text/javascript">
//document.getElementById("arrayexample").removeAttribute("ms-skip")
            avalon.ready(function() {
                var model = avalon.define(function(scope) {
                    scope.items = [
                        {name: "Well-Travelled Kitten", sales: 352, price: 75.95},
                        {name: "Speedy Coyote", sales: 89, price: 190.00},
                        {name: "Furious Lizard", sales: 1052, price: 25.00},
                        {name: "Indifferent Monkey", sales: 1, price: 99.95},
                        {name: "Brooding Dragon", sales: 0, price: 6350},
                        {name: "Ingenious Tadpole", sales: 39450, price: 0.35},
                        {name: "Optimistic Snail", sales: 420, price: 1.50}
                    ]
                    scope.showItems = [];//当前页面要显示出来的items
                    scope.pageIndex = 0; //当前页数
                    scope.pageCount = 3; //每页显示多个item
                    scope.pages = [];//装着所有页码,以零开始
                    scope.getShowItems = function() {
                        var i = scope.pageIndex, c = scope.pageCount;
                        scope.showItems = scope.items.slice(i * c, (i + 1) * c)
                        console.log(scope.showItems.length)
                    }
                    scope.addItem = function() {
                        var a = {name: "New item", sales: 0, price: 100};
                        scope.items.push(a);
                        scope.showItems.push(a);
                        scope.getPages()
                    };
                    scope.removeItem = function() {
                        var item = this.$scope.$remove();
                        scope.items.remove(item);
                        if (scope.showItems.length == 0) {
                            scope.getShowItems();
                        }
                        //  setTimeout(function(){
                        //        console.log(scope.items.length)
                        //   },1000)
                        scope.getPages();
                    };
                    scope.getPages = function() {
                        var total = Math.ceil(scope.items.size() / scope.pageCount);
                        scope.pages = avalon.range(total);//用法与python, underscorejs一致,生成一个整数数组
                    }
                    function compare(a, b) {
                        return a.name < b.name ? -1 : 1;
                    }
                    scope.sortByName = function() {
                        scope.items.sort(compare);
                        scope.showItems.sort(compare);
                    };
                    scope.jumpToFirstPage = function() {
                        scope.pageIndex = 0
                        scope.getShowItems()
                    };
                    scope.jumpPage = function() {
                        scope.pageIndex = this.$scope.$index;
                        scope.getShowItems()
                    }
                });
                model.getShowItems();
                model.getPages()
                avalon.scan();
            })

        </script>
        <fieldset id="arrayexample" >
            <legend>例子</legend>
            <div class="liveExample">                   
                <table class="ms-grid" cellspacing="0" >                        
                    <thead>                           
                        <tr>                
                            <th>Item Name</th> 
                            <th>Sales Count</th>  
                            <th>Price</th>    
                            <th>Handle</th>   
                        </tr>                 
                    </thead>                  
                    <tbody ms-each-row="showItems">    
                        <tr >          
                            <td>{{row.name}}</td> 
                            <td>{{row.sales | number}}</td>                                                           
                            <td>${{row.price }}</td>  
                            <td><a href="###" ms-click="removeItem">删除</a></td>   
                        </tr>                                                
                    </tbody>                   
                </table>                    
                <div class="ms-grid-pageLinks">                  
                    <span>Page:</span>                        
                    <span ms-each-page="pages">
                        <a href="#{{page}}" ms-click="jumpPage"  ms-class-selected="$index==pageIndex"   >{{page+1}}</a>
                    </span>      
                </div>
                <button ms-click='addItem'>
                    Add item
                </button>
                <button ms-click='sortByName'>
                    Sort by name
                </button>
                <button ms-enabled="pageIndex" ms-click="jumpToFirstPage">
                    Jump to first page
                </button>
            </div>
        </fieldset>
    </body>
</html>