<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <title>mass Framework</title>
        <script type="text/javascript" src="../src/mass.js" charset="UTF-8"></script>
        <style id="aaa">
            .mass_main_menu , .mass_sub_menu{
                width:130px;
                -moz-box-shadow:0 0 10px #06c;
                -webkit-box-shadow:0 0 10px #06c;
                box-shadow:0 0 10px #06c;
            }
            .mass_menu_item{
                width:120px;
                padding-left:10px;
                height:24px;
                line-height:24px;
                border-bottom:1px solid #fff;
                background:#0088aa;
                color:#fff;
            }
            .hover {
                background:#f36100!important;
                color:black;
            }
            .mass_sub_menu{
                display:none;
            }
            .hover > .mass_sub_menu{
                display:block
            }
        </style>
        <script>
            $.require("ready,node", function(){
                var  quote = String.quote ||  (function(){
                    var meta = {
                        '\b': '\\b',
                        '\t': '\\t',
                        '\n': '\\n',
                        '\f': '\\f',
                        '\r': '\\r',
                        '"' : '\\"',
                        '\\': '\\\\'
                    },
                    reg = /[\x00-\x1F\'\"\\\u007F-\uFFFF]/g,
                    regFn = function(c){
                        if (c in meta) {
                            return '\\' + meta[c];
                        }
                        var ord = c.charCodeAt(0);
                        return ord < 0x20   ? '\\x0' + ord.toString(16)
                        :  ord < 0x7F   ? '\\'   + c
                        :  ord < 0x100  ? '\\x'  + ord.toString(16)
                        :  ord < 0x1000 ? '\\u0' + ord.toString(16)
                        : '\\u'  + ord.toString(16)
                    };
                    return function (str) {
                        return    '"' + str.replace(reg, regFn)+ '"';
                    }
                })()

                var node = $("#bbb")[0];
                var text = node.text;
               // var text = node.styleSheet ? node.styleSheet.cssText : node.innerHTML;
                console.log(text);
                var text = "{test:"+quote(text)+"}"
                var obj = eval("0,"+text)
                console.log(obj)
            })
        </script>
        <script type="txt" id="bbb">
            $.require("ready,node,event,attr,fx",function(){
          

                var defaults = {
                    data:[],
                    hover_class: "hover",
                    item_class: "mass_menu_item",
                    main_class: "mass_main_menu",
                    sub_clas: "mass_sub_menu",
                    direction: "vertical"
                }
                var Menu = $.factory({
                    init: function(el, opts){
                        this.setOptions(defaults ,  opts || {});
                        var target = this.element = $(el);
                        var hover = this.hover_class;
                        this.addMenu(target, this.main_class); //添加主菜单的容器
                        this.addItems(target, this.data );//添加主菜单与多级子菜单
                        delete this.data;//结构过于庞大，没有必要储存它
                        if(this.direction == "horizontal"){
                            var first =  target.find(">."+this.item_class).css("float","left");
                            first.find("> ."+this.sub_class).css({
                                top: first.innerHeight(),
                                left: 0,
                                zIndex:~~first.css("z-index")+1
                            })
                        }
                        //绑定hover事件
                        target.delegate("."+this.item_class, "mouseover", function(){
                            $(this).addClass(hover).siblings().removeClass(hover);
                        });
                    },
                    addMenu : function( parent, cls ){
                        return $("<div />").appendTo( parent ).addClass(cls)
                    },
                    addItems: function( parent, objects ){
                        for(var i = 0, object; object = objects[i++];){
                            var item = this.addItem(parent, object );
                            if(object.sub && object.sub.length){
                                item.css( "position","relative");
                                var sub_menu = this.addMenu(item).css({
                                    position:"absolute",
                                    top:  0,
                                    left: item.outerWidth()
                                }).addClass( this.sub_class )
                                this.addItems( sub_menu, object.sub );
                            }
                        }
                        return this;
                    },
                    addItem: function( parent, opts){
                        var item = $("<div/>").addClass( this.item_class )
                        for(var i in opts){
                            if(typeof item[ i ] === "function"){
                                item[ i ]( opts[ i ] );
                            }
                        }
                        return item.appendTo( parent );
                    }
                });
                $.fn.menu = function (option) {
                    return this.each(function () {
                        var $this = $(this)
                        , data = $this.data('menu')
                        , options = typeof option == 'object' && option
                        if (!data) $this.data('menu', (data = new Menu(this, options)))
                        if (typeof option == 'string') data[option]()
                    })
                }
                var data = [
                    {   html:"菜单1",
                        sub:[
                            {html:"菜单1-1"},
                            {html:"菜单1-2",
                                sub:[
                                    {html:"菜单3-1"},
                                    {html:"菜单3-2"}
                                ]
                            }
                        ]
                    },
                    {html:"菜单2",
                        sub:[
                            {html:"菜单2-1"},
                            {html:"菜单2-2"}
                        ]},
                    {html:"菜单3"},
                    {html:"菜单4"}
                ]
                $("body").menu({
                    data: data
                });


            })
        </script>

    </head>
    <body>
        <h1>XXXXXXXXXXXXXXX</h1>
        <h1>XXXXXXXXXXXXXXX</h1>
    </body>
</html>

