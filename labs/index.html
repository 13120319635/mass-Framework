<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <title>mass Framework</title>


        <script type="text/javascript" src="../src/mass.js" charset="UTF-8"></script>
        <script type="text/javascript" src="ko.js" charset="UTF-8"></script>

        <script>

        </script>

    </head>
    <body>
        <script type="text/javascript">
            //  $.require("ready,more/avalon", function(){
            //http://www.cnblogs.com/pandora/archive/2009/12/20/levenshtein_distance.html
            //https://gist.github.com/982927
            //http://www.blogjava.net/phyeas/archive/2009/01/10/250807.html
            window.onload = function(){
                //通过levenshtein distance算法返回一个矩阵，matrix[y][x]为最短的编辑长度
                var getEditDistance = function(from, to){
                    var matrix = [], fn = from.length, tn = to.length;
                    // 初始化一个矩阵,行数为b,列数为a
                    var i,j
                    for(i = 0; i <= tn; i++){
                        matrix[i] = [i];//设置第一列的值
                    }
                    for(j = 0; j <= fn; j++){
                        matrix[0][j] = j;//设置第一行的值
                    }
                    // 填空矩阵
                    for(i = 1; i <= tn; i++){
                        for(j = 1; j <= fn; j++){
                            if(to.charAt(i-1) == from.charAt(j-1)){
                                matrix[i][j] = matrix[i-1][j-1];//没有改变
                            } else {
                                matrix[i][j] = Math.min(matrix[i-1][j-1] + 1, //代替 substitution
                                matrix[i][j-1] + 1, // 插入insertion
                                matrix[i-1][j] + 1); //删除 deletion
                            }
                        }
                    }
               
                    return matrix
                };
                //返回具体的编辑步骤
                var getEditScripts = function(from, to, matrix){
                    var x = from.length;
                    var y = to.length;
                    var cost = matrix[y][x];
                    var scripts = [], i = 0, action
                    if(x == 0){//如果原数组为0,那么新数组的都是新增的
                        for(var i = 0; i < y; i++){
                            scripts[scripts.length] = {
                                action: "add",
                                value: to[i]
                            }
                        }
                        return scripts;
                    }
                    if(y == 0){//如果新数组为0,那么我们要删除所有旧数组的元素
                        for(var i = 0; i < x; i++){
                            scripts[scripts.length] = {
                                action: "delete",
                                value: from[i]
                            }
                        }
                        return scripts;
                    }

                    console.log("原字符串： "+from)
                    console.log("目标字符串： "+to)
                    console.log("最短的编辑长度： "+cost)
                    console.log("比较矩阵： ")
                    console.log(matrix.join("\n"))
                    i =  Math.max(x,y);

                    /* while(scripts.length != i ){
                        action =  "retain"
                        var cur = matrix[y][x];
                        var top = matrix[y-1][x]
                        var left = matrix[y][x-1]
                        if(top == left){
                            x--;
                            y--
                            if(top == cur && cost){
                                cost--;
                                action = "update"
                                console.log("update")
                            }
                        }else{
                       
                            if(top + 1 === cur){
                                console.log(top +" VS "+cur)
                                action = "add";
                                console.log("add")
                                y--;
                            }
                            if( left + 1 == cur){
                                action = "delete";
                                //console.log("delete")
                                x--;
                            }else if(top - 1 == left){
                                //   console.log(top + "VS " + left)
                                action = "delete";
                                // console.log("delete2")
                                scripts[scripts.length] = {
                                    action:  "retain"
                                }
                                y++;
                            }
                            //console.log(matrix[y][x])
                            cost--;
       
                        }
                        scripts[scripts.length] = {
                            action:  action
                        }


                    }*/
                    console.log("具体步骤：")
                    console.log(scripts.reverse())
                }
                console.log("===================")
                var old = "ABCD", neo = "ACBD"
                var m = getEditDistance( old, neo);
                getEditScripts( old, neo,m)
            }
            //  console.log("===================")
            // getEditDistance( "AAA","CCC");
            //    var matrix = [[],[]];
            //倒序
            //如果它等于上边的与左边的说明发现改变

        </script>
    <style>
        .compare{
            border:1px solid #000;
            border-collapse:collapse;
        }
        .compare td{
            border:1px solid #000;
            width:30px;
            height:30px;
            text-align:center;
            background:olive;
        }
        td.zero{
            background:teal;
        }
        td.retain{
            background:orange;
        }
        td.update{
            background:fuchsia;
        }
        td.delete{
            background:red;
        }
        td.add{
            background:lime;
        }
    </style>
    <p>ABDEFG &nbsp;   ACEF  </p>
    <table class="compare">
        <tr>
            <td class="zero">0</td>
            <td>1</td>
            <td>2</td>
            <td>3</td>
            <td>4</td>
            <td>5</td>
            <td>6</td>
        </tr>
        <tr>
            <td>1</td>
            <td class="retain">0</td>
            <td>1</td>
            <td>2</td>
            <td>3</td>
            <td>4</td>
            <td>5</td>
        </tr>
        <tr>
            <td>2</td>
            <td>1</td>
            <td class="update">1</td>
            <td>2</td>
            <td>3</td>
            <td>4</td>
            <td>5</td>
        </tr>
        <tr>
            <td>3</td>
            <td>2</td>
            <td>2</td>
            <td class="delete">2</td>
            <td class="retain">2</td>
            <td>3</td>
            <td>4</td>
        </tr>
        <tr>
            <td>4</td>
            <td>3</td>
            <td>3</td>
            <td>3</td>
            <td>3</td>
            <td class="retain">2</td>
            <td class="delete">3</td>
        </tr>
    </table>
    <ol>
        <li> top > left  cur==next ; action = "delete"; cur = left;  x--;</li>
        <li> top == left cur==next ; action = "retain"; cur = next;  x-- y--;</li>
        <li> top > left  cur==next ; action = "retain"; cur = left;  x--; flag=true;</li>
        <li> top == left cur==next+1 x-- y-- ; cur=next; action="update";  flag == true; action="delete"; flag=false;</li>
        <li> top == left cur==next+1 x-- y-- ; cur=next; action="update";  </li>
        <li> top == left cur==next   x-- y-- ; cur=next; action="retain";  </li>
    </ol>
    <hr/>
    <p> ABDEFG &nbsp;  ACEFF </p>
    <table class="compare">
        <tr>
            <td class="zero">0</td>
            <td>1</td>
            <td>2</td>
            <td>3</td>
            <td>4</td>
            <td>5</td>
            <td>6</td>
        </tr>
        <tr>
            <td>1</td>
            <td class="retain">0</td>
            <td>1</td>
            <td>2</td>
            <td>3</td>
            <td>4</td>
            <td>5</td>
        </tr>
        <tr>
            <td>2</td>
            <td>1</td>
            <td class="update">1</td>
            <td>2</td>
            <td>3</td>
            <td>4</td>
            <td>5</td>
        </tr>
        <tr>
            <td>3</td>
            <td>2</td>
            <td>2</td>
            <td class="delete">2</td>
            <td class="retain">2</td>
            <td>3</td>
            <td>4</td>
        </tr>
        <tr>
            <td>4</td>
            <td>3</td>
            <td>3</td>
            <td>3</td>
            <td>3</td>
            <td class="retain">2</td>
            <td>3</td>
        </tr>
        <tr>
            <td>5</td>
            <td>4</td>
            <td>4</td>
            <td>4</td>
            <td>4</td>
            <td>3</td>
            <td class="update">3</td>
        </tr>
    </table>
    <ol>
        <li> top == left cur==next+1 x-- y-- ; cur=next; action="update";  </li>
        <li> top == left cur==next ; action = "retain"; cur = next;  x-- y--;</li>
        <li> top > left  cur==next ; action = "retain"; cur = left;  x--; flag=true;</li>
        <li> top == left cur==next+1 x-- y-- ; cur=next; action="update";  flag == true; action="delete"; flag=false;</li>
        <li> top == left cur==next+1 x-- y-- ; cur=next; action="update";  </li>
        <li> top == left cur==next   x-- y-- ; cur=next; action="retain";  </li>
    </ol>
    <hr/>
    <p> ABDE  &nbsp;  ABCDEF </p>
    <table class="compare">
        <tr>
            <td class="zero">0</td>
            <td>1</td>
            <td>2</td>
            <td>3</td>
            <td>4</td>
        </tr>
        <tr>
            <td>1</td>
            <td class="retain">0</td>
            <td>1</td>
            <td>2</td>
            <td>3</td>
        </tr>
        <tr>
            <td>2</td>
            <td>1</td>
            <td class="retain">0</td>
            <td>1</td>
            <td>2</td>
        </tr>
        <tr>
            <td>3</td>
            <td>2</td>
            <td>1</td>
            <td class="add">1</td>
            <td>2</td>
        </tr>
        <tr>
            <td>4</td>
            <td>3</td>
            <td>2</td>
            <td class="retain">1</td>
            <td>2</td>
        </tr>
        <tr>
            <td>5</td>
            <td>4</td>
            <td>3</td>
            <td>2</td>
            <td class="retain">1</td>
        </tr>
        <tr>
            <td>6</td>
            <td>5</td>
            <td>4</td>
            <td>3</td>
            <td class="add">2</td>
        </tr>
    </table>
    <ol>
        <li>top < left cur==next  y-- ; cur=next; action="add"; </li>
        <li>top == left cur==next  y-- x--; cur=next; action="retain";  </li>
        <li>top < left cur==next y-- ;cur=next; action="retain" flag=true; </li>
        <li>top== left cur=next+1 y--,x--;action=update;flag=true; action=add;flag=false; </li>
        <li>top==left cur==next;y--,x--;action="retain" </li>
        <li>top==left cur==next;y--,x--;action="retain"</li>
    </ol>
    <hr/>
    <p> ABDE  &nbsp;  ABCDEF </p>
    <table class="compare">
        <tr>
            <td class="zero">0</td>
            <td>1</td>
            <td>2</td>
            <td>3</td>
            <td>4</td>
        </tr>
        <tr>
            <td>1</td>
            <td class="retain">0</td>
            <td>1</td>
            <td>2</td>
            <td>3</td>
        </tr>
        <tr>
            <td>2</td>
            <td>1</td>
            <td class="retain">0</td>
            <td>1</td>
            <td>2</td>
        </tr>
        <tr>
            <td>3</td>
            <td>2</td>
            <td>1</td>
            <td class="add">1</td>
            <td>2</td>
        </tr>
        <tr>
            <td>4</td>
            <td>3</td>
            <td>2</td>
            <td class="retain">1</td>
            <td>2</td>
        </tr>
        <tr>
            <td>5</td>
            <td>4</td>
            <td>3</td>
            <td>2</td>
            <td class="retain">1</td>
        </tr>
        <tr>
            <td>6</td>
            <td>5</td>
            <td>4</td>
            <td>3</td>
            <td class="add">2</td>
        </tr>
    </table>
    <ol>
        <li>top < left cur==next  y-- ; cur=next; action="add"; </li>
        <li>top == left cur==next  y-- x--; cur=next; action="retain";  </li>
        <li>top < left cur==next y-- ;cur=next; action="retain" flag=true; </li>
        <li>top== left cur=next+1 y--,x--;action=update;flag=true; action=add;flag=false; </li>
        <li>top==left cur==next;y--,x--;action="retain" </li>
        <li>top==left cur==next;y--,x--;action="retain"</li>
    </ol>
    <hr/>
    <p> AB  &nbsp;  CBGGGG </p>
    <table class="compare">
        <tr>
            <td class="zero">0</td>
            <td>1</td>
            <td>2</td>
        </tr>
        <tr>
            <td>1</td>
            <td class="update">1</td>
            <td>2</td>
        </tr>
        <tr>
            <td>2</td>
            <td>2</td>
            <td class="retain">1</td>
        </tr>
        <tr>
            <td>3</td>
            <td>3</td>
            <td  class="add">2</td>
        </tr>
        <tr>
            <td>4</td>
            <td>4</td>
            <td  class="add">3</td>
        </tr>
        <tr>
            <td>5</td>
            <td>5</td>
            <td  class="add">4</td>
        </tr>
        <tr>
            <td>6</td>
            <td>6</td>
            <td class="add">5</td>
        </tr>
    </table>
    <ol>
        <li>top < left cur==next  y-- ; cur=next; action="add"; </li>
        <li>top < left cur==next  y-- ; cur=next; action="add"; </li>
        <li>top < left cur==next  y-- ; cur=next; action="add"; </li>
        <li>top < left cur==next  y-- ; cur=next; action="add"; </li>
        <li>top == left cur==next x-- y-- ; cur=next; action="retain"; </li>
        <li>top==left cur==next+1;y--,x--;action="update"</li>
    </ol>
    <hr/>
    <p>ABCD &nbsp;  ACBD</p>
    <table class="compare">
        <tr>
            <td class="zero">0</td>
            <td>1</td>
            <td>2</td>
            <td>3</td>
            <td>4</td>
        </tr>
        <tr>
            <td>1</td>
            <td class="retain">0</td>
            <td>1</td>
            <td>2</td>
            <td>3</td>
        </tr>
        <tr>
            <td>2</td>
            <td>1</td>
            <td class="update">1</td>
            <td>1</td>
            <td>2</td>
        </tr>
        <tr>
            <td>3</td>
            <td>2</td>
            <td>1</td>
            <td class="update">2</td>
            <td>2</td>
        </tr>
        <tr>
            <td>4</td>
            <td>3</td>
            <td>2</td>
            <td>2</td>
            <td class="retain">2</td>
        </tr>
    </table>
    <ol>
        <li>top < left cur==next  y-- ; cur=next; action="add"; </li>
        <li>top < left cur==next  y-- ; cur=next; action="add"; </li>
        <li>top < left cur==next  y-- ; cur=next; action="add"; </li>
        <li>top < left cur==next  y-- ; cur=next; action="add"; </li>
        <li>top == left cur==next x-- y-- ; cur=next; action="retain"; </li>
        <li>top==left cur==next+1;y--,x--;action="update"</li>
    </ol>


</body>
</html>

