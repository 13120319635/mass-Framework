<!doctype html>
<html>
    <head>
        <title>mass Framework</title>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
        <!--  <script src="../src/enchant.js"></script>-->
        <script src="../src/mass.js"></script>
        <style type="text/css">
            #waterfall{
                width:1100px;
                background: url("../public/styles/waterfall/waterfall_bc.jpg") repeat scroll 0 0 transparent;
            }
            .clearfix:after {
                content: "";
                display: block;
                height: 0;
                clear: both;
                visibility: hidden;
            }
            .clearfix {zoom:1;}
            .waterfall-cell{
                width:198px;
                padding:20px;
                margin-top:10px;
                border:1px solid #ccc;
                -moz-box-shadow:2px 2px 10px #c96;
                -webkit-box-shadow:2px 2px 10px #c96;
                box-shadow:2px 2px 10px #c96;
                border-radius: 2px 2px 2px 2px;
                background-color: #F7F7F7;
            }
            .image-parent {
                text-align:center;
            }
            .waterfall-cell .dis{
                width:198px;
            }
            .footer{
                height:24px;
                line-height:24px;
                background:gray;
            }
        </style>

        <script>
            $.require("ready,d(http://localhost:8888/labs/waterfall-data.js),more/waterfall2,more/ejs",function(){
                var waterfall = $("#waterfall").waterfall({
                    fade: true,
                    width: 1100,
                    image:".waterfall-img",
                    columnWidth: 246,
                    columnsNumber:function(){
                        return 4
                    },
                    makeCallback: function(json, ui){
                        json.image = this.image.slice(1);
                        return  $.ejs("#cell-tmpl", json)
                    },
                    appendCallback: function(){
                        $.log($(".waterfall-img").length)
                    }

                }).waterfall("getUI");


             //   $.log(data)
                waterfall.appendDatas( data.splice(0,10) )
                waterfall.scroll(function(rollHeight, thresholds){
                    if(typeof rollHeight == "number"){
                       
                        if(rollHeight  > thresholds ){
                            $.log("111111111111111111111111")
                            waterfall.appendDatas( data.splice(0,10) )
                        }
                    }
                });

            })


        </script>

    </head>
    <body>

        <div class="waterfall clearfix" id="waterfall">

        </div>
        <script type="text/tmpl" id="cell-tmpl">
                <div class="waterfall-cell">
                <div class="image-parent">
                <img src="<&= @src &>" class="<&= @image &>" />
                </div>

                <div class="dis" ><&= @title &></div>
                </div>
        </script>

    </body>
</html>