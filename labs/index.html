<!doctype html>
<html>
    <head>
        <title>mass Framework</title>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
        <!--  <script src="../src/enchant.js"></script>-->
        <script src="../src/mass.js"></script>
        <style type="text/css">
            #waterfall{
                width:1100px;
                height:300px;
                background:red;
                /*  background: url("../public/styles/waterfall/waterfall_bc.jpg") repeat scroll 0 0 transparent;*/
            }
            .clearfix:after {
                content: "";
                display: block;
                height: 0;
                clear: both;
                visibility: hidden;
            }
            .clearfix {zoom:1;}
            .waterfall-cell{
                width:198px;
                padding:20px;
                margin-top:10px;
                border:1px solid #ccc;
                -moz-box-shadow:2px 2px 10px #c96;
                -webkit-box-shadow:2px 2px 10px #c96;
                box-shadow:2px 2px 10px #c96;
                border-radius: 2px 2px 2px 2px;
                background-color: #F7F7F7;
            }
            .image-parent {
                text-align:center;
            }
            .waterfall-cell .dis{
                width:198px;
            }
            .footer{
                height:24px;
                line-height:24px;
                background:gray;
            }
        </style>

        <script>

        
           
            $.require("flow,more/watcher",function(r,watcher){
                function computed(a, b, fn){
                    var bind = this;
                    watcher.watch(bind, a, function(){
                        fn.call(bind);
                    })
                    //  return fn.call(bind);
                }
                var Test = {
                    attrs:{
                        firstName:"xxx",
                        lastName:"yyy",
                        fullName:[function(){
                                $.log("==============")
                                return this.firstName+" "+this.lastName;
                            },"firstName","lastName",]//返回一个带标识的数组
                    }
                }
                var flow = new $.flow;
                var attrs = Test.attrs, props = [];
                for(var prop in attrs){
                    if(attrs.hasOwnProperty(prop)){
                        var value = attrs[prop];
                        if(Array.isArray(value)
                            && value.length >= 2
                            && (typeof (value[0] ) =="function")
                            && (typeof value[value.length - 1] === "string" ) ){
                            //构娅一回调,当依赖属性发生变化时,修改此属性,并把它放到它们的change事件中去
                            var callback =  value.shift()
                            var reload = typeof value[0] == "boolean" ? value.shift() : false;
                            flow.bind(value, function(){
                                callback.call(attrs)
                            },reload)
                        }else{
                            props.push(prop);

                        }
                    }

                }
                //  $.log(props)
                for(var i = 0, n = props.length; i < n; i++){
                    watcher.watch(attrs, props[i], function(p){
                       flow.fire( p )
                    })
                }

                Test.attrs.firstName = "zzz"
               // Test.attrs.lastName = "oooo"
            });
            //  $("body").mousewheel(function(e){
            //      $.log(e)
            //  })//.fire("mouseup")


            /*               var uncia = {
                    toString: function(){
                        return "[object Uncia]"
                    }
                }
                $.log( uncia );
                $.mix(uncia, $.EventTarget);
                uncia.bind("gallop", function(e){
                    $.log(e);
                    $.log(this);
                    $.log(e.target)
                }).fire("gallop");*/

            //   $.ajax.bind("success",function(e){
            //    $.log(e);
            // $.log(this+"");
            //   }).fire("success");


          
        </script>

    </head>
    <body>
        <div class="sample" id="sample1" >
            <p><input type="text" id="test"/> <span>focus fire</span></p>

            <p><input type="password" /> <span>focus fire</span></p>
        </div>
        <div class="waterfall clearfix" id="waterfall">

        </div>


    </body>
</html>